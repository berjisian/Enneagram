angular.module('rtmap').directive('layerPanel', function() {	return {		restrict : 'EA',		templateUrl : 'app/lib/rtmap/directives/layerPanel/layerPanelTemplate.html',		scope : {			map: "=",			popup: "=", //TODO			select: "=", //TODO			onLayerChange : '&',			api: '=?'		},		controller : function($scope) {			$scope.api = $scope.api || {};			$scope.api.refresh = function(){				var layers = $scope.map.getLayers().getArray();				$scope.addedLayers = [];				layers.forEach(function(layer){					if(layer.get('name') !== 'base_map_group'){						$scope.addedLayers.push(layer);					}				});			};			$scope.baseLayers = $scope.map.getOneLayer('base_map_group').getLayers().getArray();			$scope.showLayerOptions = function(){				$scope.layerOptions = !$scope.layerOptions; 			}			$scope.changeLayerVisibility = function(selectedLayer){				//TODO this should be handle better				//var overlayers = $scope.map.getOverlays().getArray();				var overlayers = $scope.baseLayers;				if(overlayers.length){					for (var int = 0; int < overlayers.length; int++) {						overlayers[int].setVisible(false);						//overlayers[int].hide();					}				}				selectedLayer.setVisible(true);				//selectedLayer.setVisible(!selectedLayer.getVisible());				if($scope.onLayerChange){					$scope.onLayerChange( { layer : selectedLayer } );				}				$scope.map.updateSize();			};			// init			$scope.api.refresh();		},		link : function(scope, element, attrs, ctrls) {}	};});